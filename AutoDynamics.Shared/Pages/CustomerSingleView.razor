@page "/customer/details"
@using AutoDynamics.Shared.Modals
@using AutoDynamics.Shared.Services
@inject ICurrentData CurrentCustomer
@inject IDatabaseHandler DatabaseHandler

<div class="container mt-4">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Customer Details</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Customer ID:</strong> @customerData.CustomerId</p>
                    <p><strong>Name:</strong> @customerData.Name</p>
                    <p><strong>Contact:</strong> @customerData.Contact</p>
                    <p><strong>GSTIN:</strong> @customerData.GSTIN</p>
                    <p><strong>Address:</strong> @customerData.Address</p>
                    <p><strong>Area:</strong> @customerData.Area</p>
                    <p><strong>City:</strong> @customerData.City</p>
                    <p><strong>State:</strong> @customerData.State</p>
                    <p><strong>Country:</strong> @customerData.Country</p>
                    <p><strong>District:</strong> @customerData.District</p>
                    <p><strong>PinCode:</strong> @customerData.PinCode</p>
                    <p><strong>Nationality:</strong> @customerData.Nationality</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Email:</strong> @customerData.Email</p>
                    <p><strong>SMS Allowed:</strong> @(customerData.IsSMSAllowed ? "Yes" : "No")</p>
                    <p><strong>Email Allowed:</strong> @(customerData.IsEmailAllowed ? "Yes" : "No")</p>
                    <p><strong>WhatsApp Allowed:</strong> @(customerData.IsWhatsAppAllowed ? "Yes" : "No")</p>
                    <p><strong>Created By:</strong> @customerData.CreatedBy</p>
                    <p><strong>Created At:</strong> @customerData.CreateAt</p>
                    <p><strong>Updated By:</strong> @customerData.LastUpdatedBy</p>
                    <p><strong>Last Updated At:</strong> @customerData.LastUpdatedAt</p>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container mt-4">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Vehicle Details</h4>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Vehicle No</th>
                    <th>Vehicle Make</th>
                    <th>Model Name</th>
                </tr>
            </thead>
            <tbody>
                @if (vehicles.Count == 0)
                {
                    <tr>
                        <td colspan="10" class="text-center text-muted">No customers found.</td>
                    </tr>
                }
                else
                {
                    @foreach (var vehicleCustomer in vehicles)
                    {
                        <tr>
                            <td>@vehicleCustomer.VehicleNo</td>
                            <td>@vehicleCustomer.VehicleMake</td>
                            <td>@vehicleCustomer.ModelName</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
@code
{
    UserModal customerData { get; set; } = new UserModal();
    List<VehicleType> vehicles { get; set; } = new List<VehicleType>();

    protected override async Task OnInitializedAsync()
    {
        vehicles.Clear();
        customerData = (UserModal) CurrentCustomer.GetCurrentCustomer();
        string query = $"SELECT * FROM Vehicle WHERE CustomerID = '{customerData.CustomerId}'";
        var res = await DatabaseHandler.ExecuteQueryAsync(query);
        if(res.Count>0)
        {
            foreach(var row in res)
            {
                vehicles.Add(new VehicleType
                {
                        CustomerID = row["CustomerID"].ToString() ?? "",
                        VehicleNo = row["VehicleNo"].ToString() ?? "",
                        VehicleMake = row["VehicleMake"].ToString() ?? "",
                        MfgYear = Int32.Parse(row["MfgYear"].ToString() ?? "0"),
                        ModelName = row["ModelName"].ToString() ?? "",
                        Description = row["Description"].ToString() ?? "",
                        CreateAt = row["CreateAt"].ToString() ?? "",
                        CreatedBy = row["CreatedBy"].ToString() ?? "",
                        LastUpdatedAt = row["LastUpdatedAt"].ToString() ?? "",
                        LastUpdatedBy = row["LastUpdatedBy"].ToString() ?? ""
                });
            }
        }
    }
}
